# 如何利用Performance API获取FCP, LCP, TTI等指标
1. 获取FCP

```javascript
if ('paint' in performance) {
  const fcp = performance.getEntriesByType('paint').find(entry => entry.name === 'first-contentful-paint')
  if (fcp) {
    console.log(`FCP: ${fcp.startTime.toFixed(2)}`)
  }
} else {
  console.log('FCP not supported')
}
```

2. 获取LCP: 使用PerformanceObserver

```javascript
if ('getEntriesByName' in performance && 'observer' in performance) {
  const entryCallback = (entries, observer) => {
    entries.forEach(entry => {
      if (entry.name === 'largest-contentful-paint') {
        console.log(`Largest Contentful Paint: ${entry.startTime.toFixed(2)} ms`);
        observer.disconnect(); // 一旦获取到LCP，就停止监听
      }
    });
  };

  const observer = new PerformanceObserver(entryCallback);
  observer.observe({ type: 'largest-contentful-paint', buffered: true });
} else {
  console.log('PerformanceObserver or getEntriesByName not supported.');
}
```

3. 获取TTI
```javascript
function estimateTTI() {
  const interactiveThreshold = 50; // 长任务阈值（毫秒）
  const timeout = 5000; // 最长等待时间（毫秒）

  let lastInteractiveTime = performance.now();
  let isInteractive = false;

  const observer = new PerformanceObserver((list, obs) => {
    for (const entry of list.getEntries()) {
      if (entry.duration > interactiveThreshold) {
        isInteractive = false;
        lastInteractiveTime = performance.now();
      } else if (!isInteractive) {
        isInteractive = true;
        clearTimeout(timeoutId);
        const tti = lastInteractiveTime - performance.timing.navigationStart;
        console.log(`Estimated Time To Interactive: ${tti.toFixed(2)} ms`);
        obs.disconnect();
      }
    }
  });

  observer.observe({ entryTypes: ['event'] });

  const timeoutId = setTimeout(() => {
    observer.disconnect();
    console.log('TTI estimation timed out.');
  }, timeout);
}

estimateTTI();
```

# 如何利用Performance API进行页面布局变动等埋点

1. 布局偏移(layout-shift): 页面元素在加载过程中突然改变位置的情况
2. 监听重排（Reflow, longtask）
3. 监听重绘 Paint
4. 监听长任务（longtask）