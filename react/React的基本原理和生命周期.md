# React的基本原理

1. 组件化: React推崇将应用拆分成一系列小而专一的组件, 每个组件负责界面的一小部分

2. 虚拟DOM: React使用虚拟Dom来提高性能, 当组件状态改变时, React会计算出虚拟dom跟真实dom之间的差异, 然后批量更新



# React生命周期

## 初始化阶段
construct  -> getDerivedStateFromProps -> render -> componentDidMount

## 更新阶段

getDerivedStateFromProps -> shouldComponentUpdate -> render -> getSnapshotBeforeUpdate -> componentDidUpdate

## 卸载阶段

componentWillUnmount





# React虚拟dom

## 虚拟dom的定义

虚拟dom是一个js对象结构, 每个虚拟dom节点都对应一个类型(div,span), 可能还有属性(className, style), 以及子节点. React使用这种结构来追踪界面的更改

## 虚拟dom的优势

性能提升: 直接真实操作dom是非常昂贵的操作, react通过虚拟dom在内存中执行修改, 然后一次同步到真实dom上, 减少重绘和回流

一致性: 由于react组件无论在web还是原生平台都使用相似的API来描述UI, 所以虚拟dom实现跨平台的一致性

易于测试: 虚拟DOM使得测试react应用更容易, 因为可以脱离浏览器进行测试


## diff算法

深度优先遍历: React会对新旧两颗树进行深度优先遍历, 对比节点的不同

主键优化(Key Optimization): React会对列表项中的每一项添加唯一标识key, React可以更快的识别哪些项需要添加,删除,移动

具体细节

  节点类型匹配(比较根节点类型, 类型不同替换整个dom) -> 属性比较(如果节点类型相同, 那么就会比较节点的属性, 如果属性不同, 会更新响应的属性值)
->子节点匹配(上述比较都满足,那么会比较子节点,如果子节点有key就用key确定子节点的位置, 如果没有key, 则按照索引从前到后的顺序进行查找比较)
->react使用key来标识每个元素,以便列表变化知道哪些元素需要增加删除移动,如果列表元素没有key,那么就会基于索引进行匹配,可能照成不必要的渲染



## React Fiber

在渲染过程中如果有优先级更高的任务, 则react渲染会中断从而处理优先级更高的任务, 等处理完优先级更高的任务再恢复渲染.

1. 每个Fiber节点包含组件的状态信息, 如它是否正在处理, 何时应该继续处理. Fiber节点之间形成一个树状结构, 类似于虚拟DOM, 但是每个节点包含额外的信息, 用于跟踪和管理渲染进程

2. 优先级系统: 高优先级的任务(例如用户交互)会被有限处理, 而低优先级的任务(例如定时更新)会被延时处理.
优先级系统使得React更好地响应用户交互, 并保证资源充足的情况下, 处理优先级更好的任务.

3. 流程: 
初始化(组件开始更新时, react会创建一个新的Fiber树的根节点, 并开始构建新的Fiber树) -> 
构建阶段(react会遍历组件树, 为每个组件更新或创建Fiber节点, 在这过程中会比较新旧DOM节点,以便进行最小化更新, 在这过程中如果遇到优先级更高的任务则会处理优先级更高的任务, 在适当的时候恢复构建) -> 
提交阶段(在新的Fiber树构建完成后, react会进入提交阶段, 将变更应用到实际dom, 在这个节点react会执行副作用(dom更新),以及清理掉不必要的Fiber节点)


